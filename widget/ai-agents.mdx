---
title: "Integrate an AI Agent into the Chat Widget"
sidebarTitle: "AI Agent + Widget"
description: "Add an AI Agent (Mastra) to the CometChat Chat Widget using the no‑code builder and a simple embed."
---

<Callout>
AI Agents are in Developer Preview and currently support **Mastra**. Additional providers are coming soon.
</Callout>

## TL;DR
1. Create/verify your Mastra agent (get its public endpoint + ID).  
2. In CometChat Dashboard: create / open your app.  
3. Open Chat Builder → enable AI Agent → select your Mastra agent.  
4. (Optional) Add Frontend Actions & Tools.  
5. Customize look & features.  
6. Export embed code & drop it into your app.  
7. Verify: agent responds + actions work.

---

## Prerequisites

- CometChat app (App ID, Region, Auth Key).
- Chat Widget variant (will produce a Widget / Variant ID).
- A running Mastra agent endpoint (public or tunneled URL).
- Mastra Agent ID (e.g. `chef`) and any required API key(s).
- (Optional) Frontend Action definitions if you want UI‑bound behaviors.

---

## Step 1 — Create / Verify Your Mastra Agent

Have a Mastra project ready (example using the “Chef” agent):

<AccordionGroup>
  <Accordion title="Minimal example (tools + agent)">
```ts
// tools/suggest-substitute.ts & tools/recipe-from-pantry.ts (omitted for brevity)
// agents/chef-agent.ts (export chefAgent)
// mastra/index.ts
import { Mastra } from '@mastra/core/mastra';
import { chefAgent } from './agents/chef-agent';

export const mastra = new Mastra({
  agents: { chef: chefAgent } // 'chef' becomes /api/agents/chef/*
});
```
  </Accordion>
  <Accordion title="Local run & test">
```bash
npx mastra dev
curl -X POST http://localhost:4111/api/agents/chef/generate \
  -H "Content-Type: application/json" \
  -d '{"messages":[{"role":"user","content":"Hello chef"}]}'
```
  </Accordion>
</AccordionGroup>

You now have:
- Agent ID (e.g. `chef`)
- Base URL (e.g. `http://localhost:4111/api` or public tunnel)

---

## Step 2 — Configure AI Agent in CometChat

1. Open the [CometChat Dashboard](https://app.cometchat.com/).  
2. Go to your App → AI / Agents (Preview).  
3. Add a new AI Agent:
   - Provider: Mastra  
   - Agent ID: `chef`  
   - Endpoint URL: `https://YOUR_PUBLIC_ENDPOINT/api/agents/chef/generate`  
4. Save & enable.

---

## Step 3 — Attach Agent in Chat Builder (No‑Code)

1. Open **Chat Builder** → select / create a **Widget Variant**.  
2. In AI / Agents section, enable the agent you configured.  
3. (Optional) Give it a display name + avatar.  
4. Save.

---

## Step 4 — (Optional) Frontend Actions & Tools

If you plan to let the agent trigger UI changes:
1. Define actions in Dashboard (name + schema).  
2. Map them to Mastra tools (IDs must match if you expect tool invocation context).  
3. (Later) Handle them in your custom UI OR rely on widget’s built‑in handling (if provided).

---

## Step 5 — Customize Widget

In Chat Builder:
- Appearance: theme, colors, typography.  
- Features: message types, moderation, typing indicators, read receipts.  
- Layout: position, launcher, branding.  
Save + Preview frequently.

---

## Step 6 — Export & Embed

In Chat Builder click **Get Embedded Code** → copy credentials:
- App ID
- Auth Key
- Region
- Widget (Variant) ID

Example embed (HTML):

```html lines highlight={5-7,20-34}
<div id="cometchat-widget" style="height:600px;width:100%;"></div>
<script defer src="https://widget.cometchat.io/v3/cometchat-widget.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', async () => {
    await CometChatWidget.init({
      appID: "YOUR_APP_ID",
      authKey: "YOUR_AUTH_KEY",
      region: "YOUR_REGION"
    });

    // (Optional) Pre-login a known user (similar pattern as builder-guide-html)
    await CometChatWidget.login({ uid: "UID" });

    await CometChatWidget.launch({
      widgetID: "YOUR_WIDGET_ID",
      target: "#cometchat-widget",
      // Attach AI Agents (array allows future multiples)
      aiAgents: [
        {
          id: "chef",          // CometChat AI Agent ID (same as configured)
          displayName: "Chef", // Optional override
          // future: avatar: "https://cdn/chef.png"
        }
      ],
      // Optional initial conversation focus
      // chatType: 'user',
      // defaultChatID: 'chef',
    });
  });
</script>
```

### Advanced: Auto‑Provision & Action Handling

If you need to create a user on the fly and then mount the widget:

```html
<script>
async function ensureAndLaunch(){
  await CometChatWidget.init({ appID: "APP", authKey: "AUTH", region: "REGION" });
  try {
    await CometChatWidget.login({ uid: "visitor_123" });
  } catch(e) {
    if(e?.code === 'ERR_UID_NOT_FOUND') {
      await fetch('/api/create-cometchat-user', { method:'POST', body: JSON.stringify({ uid: 'visitor_123' })});
      await CometChatWidget.login({ uid: "visitor_123" });
    } else { throw e; }
  }
  await CometChatWidget.launch({
    widgetID: "YOUR_WIDGET_ID",
    target: "#cometchat-widget",
    aiAgents: [{ id: 'chef' }],
    onFrontendAction: (action) => {
      // Handle actions emitted by the AI Agent (future: map to UI changes)
      console.log('[AI Frontend Action]', action.id, action.payload);
    }
  });
}
document.addEventListener('DOMContentLoaded', ensureAndLaunch);
</script>
```

> The `onFrontendAction` hook (if enabled in this preview) allows your agent tools to trigger UI behaviors. Keep payloads small (\<2KB) and idempotent.

---

## Step 7 — Verify

| Check | How |
|-------|-----|
| Agent appears | Open widget → new conversation / agent entry available |
| Basic reply | Send a prompt → response under a few seconds |
| Tool logic works | Ask for ingredient substitution / recipe (Chef example) |
| Error free | Browser console + Mastra logs have no unhandled errors |

<Callout>
If responses fail, confirm the endpoint is publicly reachable and the Agent ID matches the Dashboard configuration.
</Callout>

---

## Troubleshooting

| Issue | Fix |
|-------|-----|
| Agent not listed | Confirm it’s enabled in Dashboard + variant saved |
| 404 from Mastra | Endpoint path or agent key mismatch |
| Timeout | Expose via a tunnel or deploy to a public host |
| Tool not invoked | Ensure tool ID referenced in agent instructions & code |
| Auth error | Re-check Auth Key / App credentials in embed snippet |

---

## Next Steps

- Add more tools (search, summarization, domain knowledge).  
- Introduce Frontend Actions for richer UI control.  
- Move from tunnel to production deployment.  
- Add analytics / observability (latency, error tracking).  

Need code export (React UI Kit) instead of Widget? See the “Export & Integrate” guide in AI Agents