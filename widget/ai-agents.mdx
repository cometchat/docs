---
title: "Integrate an AI Agent into the Chat Widget"
sidebarTitle: "AI Agent + Widget"
description: "Add an AI Agent (Mastra) to the CometChat Chat Widget using the no‑code builder and a simple embed."
---

<Note>
AI Agents currently support **Mastra**. Additional providers are coming soon.
</Note>

## Prerequisites

- CometChat app (App ID, Region, Auth Key).
- Chat Widget variant (will produce a Widget / Variant ID).
- A running Mastra agent endpoint (public or tunneled URL).
- Mastra Agent ID (e.g. `chef`) and any required API key(s).
- (Optional) Frontend Action definitions if you want UI‑bound behaviors.

---

<h3 className="text-2xl font-semibold mb-6 mt-8">
  <span className="inline-flex items-center px-4 py-1.5 rounded-full bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-300 uppercase tracking-wide text-sm">Step 1</span>
</h3>

## Create / Verify Your Mastra Agent

Have a Mastra project ready (example using the “Chef” agent):

<AccordionGroup>
  <Accordion title="Minimal example (tools + agent)">
```ts
// tools/suggest-substitute.ts & tools/recipe-from-pantry.ts (omitted for brevity)
// agents/chef-agent.ts (export chefAgent)
// mastra/index.ts
import { Mastra } from '@mastra/core/mastra';
import { chefAgent } from './agents/chef-agent';

export const mastra = new Mastra({
  agents: { chef: chefAgent } // 'chef' becomes /api/agents/chef/*
});
```
  </Accordion>
  <Accordion title="Local run & test">
```bash
npx mastra dev
curl -X POST http://localhost:4111/api/agents/chef/generate \
  -H "Content-Type: application/json" \
  -d '{"messages":[{"role":"user","content":"Hello chef"}]}'
```
  </Accordion>
</AccordionGroup>

You now have:
- Agent ID (e.g. `chef`)
- Base URL (e.g. `http://localhost:4111/api` or public tunnel)

---

<h3 className="text-2xl font-semibold mb-6 mt-8">
  <span className="inline-flex items-center px-4 py-1.5 rounded-full bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-300 uppercase tracking-wide text-sm">Step 2</span>
</h3>

## Configure AI Agent in CometChat

1. Open the [CometChat Dashboard](https://app.cometchat.com/).  
2. Go to your App → AI / Agents (Preview).  
3. Add a new AI Agent:
   - Provider: Mastra  
   - Agent ID: `chef`  
   - Deployment URL: Example `loud-sparse-motorcycle.mastra.cloud`  
4. Save & enable.

---

<h3 className="text-2xl font-semibold mb-6 mt-8">
  <span className="inline-flex items-center px-4 py-1.5 rounded-full bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-300 uppercase tracking-wide text-sm">Step 3</span>
</h3>

## Attach Agent in Chat Builder (No‑Code)

1. Open **Chat Builder** → select / create a **Widget Variant**.  
2. In AI / Agents section, enable the agent you configured.  
3. (Optional) Give it a display name + avatar.  
4. Save.

---

<h3 className="text-2xl font-semibold mb-6 mt-8">
  <span className="inline-flex items-center px-4 py-1.5 rounded-full bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-300 uppercase tracking-wide text-sm">Step 4 (Optional)</span>
</h3>

## Frontend Actions & Tools

If you plan to let the agent trigger UI changes:
1. Define actions in Dashboard (name + schema).  
2. Map them to Mastra tools (IDs must match if you expect tool invocation context).  
3. (Later) Handle them in your custom UI OR rely on widget’s built‑in handling (if provided).

---

<h3 className="text-2xl font-semibold mb-6 mt-8">
  <span className="inline-flex items-center px-4 py-1.5 rounded-full bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-300 uppercase tracking-wide text-sm">Step 5</span>
</h3>

## Customize Widget

In Chat Builder:
- Appearance: theme, colors, typography.  
- Features: message types, moderation, typing indicators, read receipts.  
- Layout: position, launcher, branding.  
Save + Preview frequently.

---

<h3 className="text-2xl font-semibold mb-6 mt-8">
  <span className="inline-flex items-center px-4 py-1.5 rounded-full bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-300 uppercase tracking-wide text-sm">Step 6</span>
</h3>

## Export & Embed

In Chat Builder click **Get Embedded Code** → copy credentials:
- App ID
- Auth Key
- Region
- Variant ID

Example embed (HTML):

<Steps>
  <Step title="Include script (&lt;head&gt;)">Add script tag in document head (see snippet below).</Step>
  <Step title="Initialize (&lt;body&gt; end)">Add mount div + init script before closing body.</Step>
</Steps>

```html
<script defer src="https://cdn.jsdelivr.net/npm/@cometchat/chat-embed@latest/dist/main.js"></script>
```

```html
<div id="cometChatMount"></div>
<script>
  const COMETCHAT_CREDENTIALS = {
    appID:     "<YOUR_APP_ID>",
    appRegion: "<YOUR_APP_REGION>",
    authKey:   "<YOUR_AUTH_KEY>",
  };

  const COMETCHAT_USER_UID = "UID"; // Replace with your user UID

  const COMETCHAT_LAUNCH_OPTIONS = {
    targetElementID: "cometChatMount",
    isDocked: true,
    width: "700px",
    height: "500px",
    // variantID: "YOUR_VARIANT_ID",
  };

  window.addEventListener("DOMContentLoaded", () => {
    CometChatApp.init(COMETCHAT_CREDENTIALS)
      .then(() => CometChatApp.login({ uid: COMETCHAT_USER_UID }))
      .then(() => CometChatApp.launch(COMETCHAT_LAUNCH_OPTIONS))
      .catch(console.error);
  });
</script>
```

> Replace placeholders (`<YOUR_APP_ID>`, etc.) with real values.

---

<h3 className="text-2xl font-semibold mb-6 mt-8">
  <span className="inline-flex items-center px-4 py-1.5 rounded-full bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-300 uppercase tracking-wide text-sm">Step 7</span>
</h3>

## Verify

| Check | How |
|-------|-----|
| Agent appears | Open widget → new conversation / agent entry available |
| Basic reply | Send a prompt → response under a few seconds |
| Tool logic works | Ask for ingredient substitution / recipe (Chef example) |
| Error free | Browser console + Mastra logs have no unhandled errors |

<Callout>
If responses fail, confirm the endpoint is publicly reachable and the Agent ID matches the Dashboard configuration.
</Callout>

---

<h3 className="text-2xl font-semibold mb-6 mt-8">
  <span className="inline-flex items-center px-4 py-1.5 rounded-full bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-300 uppercase tracking-wide text-sm">Troubleshooting</span>
</h3>

| Issue | Fix |
|-------|-----|
| Agent not listed | Confirm it’s enabled in Dashboard + variant saved |
| 404 from Mastra | Endpoint path or agent key mismatch |
| Timeout | Expose via a tunnel or deploy to a public host |
| Tool not invoked | Ensure tool ID referenced in agent instructions & code |
| Auth error | Re-check Auth Key / App credentials in embed snippet |

---

<h3 className="text-2xl font-semibold mb-6 mt-8">
  <span className="inline-flex items-center px-4 py-1.5 rounded-full bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-300 uppercase tracking-wide text-sm">Next Steps</span>
</h3>

- Add more tools (search, summarization, domain knowledge).  
- Introduce Frontend Actions for richer UI control.  
- Move from tunnel to production deployment.  
- Add analytics / observability (latency, error tracking).  

Need code export (React UI Kit) instead of Widget? See the “Export & Integrate” guide in AI Agents