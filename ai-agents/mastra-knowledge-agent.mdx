---
title: "Build Your Knowledge Agent with Mastra"
description: "Follow these steps to create a Knowledge Agent in Mastra that can answer documentation questions when invoked, then connect it to CometChat."
---

Imagine an agent that answers policy, product, and FAQ questions by looking them up in your docs—concise, cited, and available right inside chat without derailing the conversation.

***

## What You’ll Build

* A **Mastra agent** that can participate in conversations as a documentation expert.  
* Triggered only when explicitly mentioned (e.g., `@agent`).  
* Can fetch knowledge from your docs and return short, sourced answers.  
* Integrated into **CometChat** chats.  

***

## Prerequisites

* A Mastra project (`npx create-mastra@latest my-mastra-app`).  
* Node.js installed.  
* OpenAI API key in `.env` as `OPENAI_API_KEY`.  
* A CometChat app.  

***

<h3 className="text-2xl font-semibold mb-6 mt-8">
  <span className="inline-flex items-center px-4 py-1.5 rounded-full bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-300 uppercase tracking-wide text-sm">Step 1</span>
</h3>

## Create the Agent

**`src/agents/knowledge/agent.ts`** (view in repo):

- Agent file: `https://REPO_BASE/blob/main/src/agents/knowledge/agent.ts`  
- Docs retriever tool: `https://REPO_BASE/blob/main/src/tools/docsRetriever.ts`  
- *(Optional)* Mastra Docs MCP tool: `https://REPO_BASE/blob/main/src/tools/mcpMastraDocsTool.ts`  
- Knowledge folder: `https://REPO_BASE/tree/main/knowledge`  

Checklist for the agent:
- Set `name` to **"knowledge"** so the API path is `/api/agents/knowledge/*`.  
- Respond **only when mentioned** (e.g., `@agent`).  
- Answer **from retrieved docs** and include a short **“Sources:”** list.  
- Register `docsRetriever` (and `mcpMastraDocsTool` if enabled).  

***

<h3 className="text-2xl font-semibold mb-6 mt-8">
  <span className="inline-flex items-center px-4 py-1.5 rounded-full bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-300 uppercase tracking-wide text-sm">Step 2</span>
</h3>

## Register the Agent in Mastra

**`src/mastra/index.ts`** (view in repo):

- Server entry: `https://REPO_BASE/blob/main/src/mastra/index.ts`  
- Ensure the agent is registered with key **"knowledge"** → API path `/api/agents/knowledge/*`.  
- Storage/logger configuration as per repo `README.md`.  

***

<h3 className="text-2xl font-semibold mb-6 mt-8">
  <span className="inline-flex items-center px-4 py-1.5 rounded-full bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-300 uppercase tracking-wide text-sm">Step 3</span>
</h3>

## Run the Agent

*Dev script & local server details are tracked in your repo:*  
- Scripts: `https://REPO_BASE/blob/main/package.json`  
- Local test examples: `https://REPO_BASE/tree/main/.http` (e.g., `knowledge.http`)  

Expected local API base: `http://localhost:4111/api`

***

<h3 className="text-2xl font-semibold mb-6 mt-8">
  <span className="inline-flex items-center px-4 py-1.5 rounded-full bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-300 uppercase tracking-wide text-sm">Step 4</span>
</h3>

## Deploy the API

- Deployment guide: `https://REPO_BASE/blob/main/docs/deploy.md`  
- Environment variables: `https://REPO_BASE/blob/main/.env.example`  
- Health check route & notes: `https://REPO_BASE/blob/main/docs/healthcheck.md`  

Ensure the public route: **`/api/agents/knowledge/generate`** is reachable.

***

<h3 className="text-2xl font-semibold mb-6 mt-8">
  <span className="inline-flex items-center px-4 py-1.5 rounded-full bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-300 uppercase tracking-wide text-sm">Step 5</span>
</h3>

## Connect to CometChat

Open CometChat Dashboard → **AI Agents** and configure:

- **Provider**: Mastra  
- **Agent ID**: `knowledge`  
- **Deployment URL**: your public generate endpoint  
- Permissions & visibility: `https://REPO_BASE/blob/main/docs/cometchat/permissions.md`  

Optional references in repo:  
- CometChat setup notes: `https://REPO_BASE/blob/main/docs/cometchat/setup.md`  
- Troubleshooting dashboard integration: `https://REPO_BASE/blob/main/docs/cometchat/troubleshooting.md`  

***

<h3 className="text-2xl font-semibold mb-6 mt-8">
  <span className="inline-flex items-center px-4 py-1.5 rounded-full bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-300 uppercase tracking-wide text-sm">Step 6</span>
</h3>

## Customize & Test in Chat

- Launch **Chat Builder** and select the agent: `https://REPO_BASE/blob/main/docs/cometchat/chat-builder.md`  
- Mention trigger rules: `https://REPO_BASE/blob/main/docs/cometchat/mention-trigger.md`  
- Add to a group/user chat: `https://REPO_BASE/blob/main/docs/cometchat/add-to-group.md`  
- UI embed examples:  
  - React UI: `https://REPO_BASE/tree/main/examples/react-chat`  
  - Chat Widget: `https://REPO_BASE/tree/main/examples/widget`  

Now the agent will answer documentation questions on demand—without hijacking the conversation.

***

## Troubleshooting

* **Agent talks too much**: tighten instructions to only respond when mentioned and to answer from docs.  
* **No results**: ensure `/knowledge` contains `.md/.mdx` files or your ingestion job populated the store.  
* **MCP tool inert**: confirm `mcp.json` at repo root and dependency for the docs server is installed.  
* **Not visible in chat**: verify the agent is added as a user in CometChat and enabled in the Dashboard.  
* **404 / Agent not found**: check that the server registers the agent with key `knowledge`.  

***

## Next Steps

* Add tools like `summarize-doc`, `fetch-policy`, or `link-to-source`.  
* Use embeddings + chunking for better retrieval.  
* Restrict answers to whitelisted folders or domains.  
* Add observability: `https://REPO_BASE/blob/main/docs/observability.md`  
* CI/CD templates: `https://REPO_BASE/tree/main/.github/workflows`  

---

**Repository**

* Root: `https://REPO_BASE`  
* Knowledge agent folder: `https://REPO_BASE/tree/main/src/agents/knowledge`  
* Tools: `https://REPO_BASE/tree/main/src/tools`  
* Server/API: `https://REPO_BASE/tree/main/src/mastra`  
* This doc: `https://REPO_BASE/blob/main/docs/ai-agents/mastra-knowledge-agent.mdx`  
