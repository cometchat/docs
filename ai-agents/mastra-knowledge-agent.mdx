---
title: "Build Your Knowledge Agent with Mastra"
description: "Create a Mastra agent that answers from your own docs or knowledge base—crawl websites, ingest local Markdown, or mix sources."
---

import { Callout, Steps, Step, Tabs, Tab, AccordionGroup, Accordion, Columns, Card, CardGroup } from 'mintlify';

Imagine a teammate who actually reads your docs. This guide shows how to build a **Mastra knowledge agent** that answers from **your** knowledge base—public docs sites, local Markdown, or both.

<Callout>
<b>Goal</b>: Ship a production-ready agent that cites sources, stays honest when docs are missing, and plugs into your chat UI.
</Callout>

---

## What You’ll Build

- A **Mastra agent** configured to use your knowledge base  
- A **Docs tool** that crawls websites and/or ingests local Markdown  
- An HTTP endpoint to query your agent (ready for any chat UI)  
- Guardrails for citations and “answer not found” behavior

---

## Prerequisites

- Node.js 18+  
- An OpenAI-compatible key in `.env` as `OPENAI_API_KEY`  
- Access to your docs (public URL with sitemap, or Markdown files)

---

## Quickstart

<Steps>
  <Step title="Scaffold the project">

```bash
npx mastra init knowledge-agent
cd knowledge-agent
npm i @mastra/core @mastra/tools-docs openai
```
This creates the Mastra app and installs the docs tool.
  </Step>
  <Step title="Choose your content source">
    <Tabs>
      <Tab title="Public Docs Website">
        <p>Best if you have a sitemap and good internal links.</p>
```ts
import { DocsTool } from "@mastra/tools-docs";

export const docsTool = new DocsTool({
  source: "https://docs.yourcompany.com",
  options: {
    maxDepth: 3,
    include: ["**/*"],
    exclude: ["**/blog/**", "**/changelog/**"],
    chunk: { size: 800, overlap: 80 },
  },
});
```
      </Tab>
      <Tab title="Local Markdown">
        <p>Drop exported docs into <code>./knowledge/</code>.</p>
```bash
# example layout
knowledge/
  getting-started.md
  auth/
    sso.md
    saml.md
```
```ts
import { DocsTool } from "@mastra/tools-docs";

export const docsTool = new DocsTool({
  source: "./knowledge/**/*.md",
  options: { chunk: { size: 700, overlap: 80 } },
});
```
      </Tab>
      <Tab title="Mixed (Website + Markdown)">
        <p>Combine a public site and private folder.</p>
```ts
import { DocsTool } from "@mastra/tools-docs";

export const docsTool = new DocsTool({
  source: [
    "https://docs.yourcompany.com",
    "./knowledge/**/*.md",
  ],
  options: { maxDepth: 2, chunk: { size: 900, overlap: 100 } },
});
```
      </Tab>
    </Tabs>
  </Step>
  <Step title="Create the agent & tool">
<code>src/tools/docsTool.ts</code>
```ts
import { DocsTool } from "@mastra/tools-docs";

export const docsTool = new DocsTool({
  // Pick ONE or combine (see previous step)
  source: "https://docs.yourcompany.com",
  options: {
    maxDepth: 3,
    include: ["**/*"],
    exclude: ["**/blog/**", "**/drafts/**"],
    chunk: { size: 800, overlap: 80 },
  },
});
```
<code>src/agents/knowledge/agent.ts</code>
```ts
import { Agent } from "@mastra/core";
import { docsTool } from "../../tools/docsTool";

export const knowledgeAgent = new Agent({
  name: "knowledge",
  instructions: `You are a precise documentation assistant.\n- Always consult the docs tool for answers.\n- Provide concise answers.\n- Add a brief "Sources" line with URLs and headings used.\n- If the answer is not in the docs, say so clearly.`,
  tools: [docsTool],
});
```
  </Step>
  <Step title="Register the agent">
<code>src/mastra/index.ts</code>
```ts
import { Mastra } from "@mastra/core";
import { knowledgeAgent } from "../agents/knowledge/agent";

export const mastra = new Mastra({
  agents: { knowledge: knowledgeAgent },
});

export default mastra;
```
  </Step>
  <Step title="Run & test">
```bash
npx mastra dev
```
Query the agent:
```bash
echo '{"messages":[{"role":"user","content":"How do I add SSO to the dashboard?"}]}' \
| curl -X POST http://localhost:4111/api/agents/knowledge/generate \
  -H "Content-Type: application/json" \
  -d @- 
```
  </Step>
</Steps>

---

## Guardrails & Quality

<Columns cols={2} className="gap-6">
  <div>
    <h3>Force citations</h3>
    <p>Keep this in the agent instructions. Users trust sourced answers.</p>
    <pre><code className="language-text">Add a brief "Sources" line with URLs and headings used.</code></pre>
  </div>
  <div>
    <h3>Honest gaps</h3>
    <p>Make it explicit that “not in docs” is a valid outcome.</p>
    <pre><code className="language-text">If the answer is not in the docs, say so clearly and suggest the closest relevant section.</code></pre>
  </div>
</Columns>

---

## Tuning the Retriever

<AccordionGroup>
  <Accordion title="Chunk size & overlap">
    <p>Shorter chunks increase recall; larger chunks increase coherence.</p>
```ts
options: { chunk: { size: 700, overlap: 80 } }
```
  </Accordion>
  <Accordion title="Scoping the crawl">
    <p>Use <code>include</code>/<code>exclude</code> to avoid marketing pages.</p>
```ts
options: {
  include: ["**/*.md", "**/*.mdx", "**/*"],
  exclude: ["**/blog/**", "**/changelog/**", "**/drafts/**"],
}
```
  </Accordion>
  <Accordion title="Re-ingestion strategy">
    <p>In CI, warm or rebuild the index after deploys so the agent stays fresh.</p>
  </Accordion>
</AccordionGroup>

---

## Common Errors

<AccordionGroup>
  <Accordion title='404: "Agent with name ... not found"'>
    <p>The route path must match the agent <code>name</code>. For <code>name: "knowledge"</code>, call <code>/api/agents/knowledge/generate</code>.</p>
  </Accordion>
  <Accordion title='Rollup: "Could not resolve ../agents/knowledge/agent"'>
    <p>Fix the import path in <code>src/mastra/index.ts</code> to match your folder layout.</p>
  </Accordion>
  <Accordion title="Empty or low-quality answers">
    <ul>
      <li>Reduce <code>chunk.size</code> or increase <code>overlap</code>.</li>
      <li>Check that your site has a sitemap and internal links.</li>
      <li>Relax overly strict <code>include</code>/<code>exclude</code> patterns.</li>
    </ul>
  </Accordion>
</AccordionGroup>

---

## Production Checklist

<CardGroup>
  <Card title="Auth" href="#">
    Protect the Mastra server behind your app’s authentication.
  </Card>
  <Card title="Observability" href="#">
    Log tool calls (queries + sources) for audits and continuous improvement.
  </Card>
  <Card title="Rate limiting" href="#">
    Gate public endpoints; throttle by user/app to avoid abuse.
  </Card>
  <Card title="UI integration" href="#">
    Pipe responses into your chat UI (CometChat, custom). Add a “Sources” pill.
  </Card>
</CardGroup>

---

## Minimal Variant (Markdown-only)

<Callout>
Just point at a folder of <code>.md/.mdx</code> and ship.
</Callout>

```ts
import { DocsTool } from "@mastra/tools-docs";
import { Agent } from "@mastra/core";

const docsTool = new DocsTool({
  source: "./knowledge/**/*.md",
  options: { chunk: { size: 700, overlap: 80 } },
});

export const knowledgeAgent = new Agent({
  name: "knowledge",
  instructions: "Answer from the docs; include a Sources line; admit gaps.",
  tools: [docsTool],
});
```

---

## FAQ

**Can I combine private Markdown with a public docs site?**  
Yes—pass an array to <code>source</code>.

**Will it cite exact headings?**  
Add that requirement to <code>instructions</code>; the tool returns passages you can link.

**Does this work without Mastra MCP servers?**  
Yes. This guide uses only your sources via <code>@mastra/tools-docs</code>
