---
title: "Build Your Knowledge Agent with Mastra"
description: "Follow these steps to create a Knowledge Agent in Mastra that can answer documentation questions when invoked and integrate with CometChat."
---

Imagine an agent that answers policy, product, and FAQ questions by looking them up in your docs—concise, cited, and available right inside chat without derailing the conversation.

***

## What You’ll Build

* A **Mastra agent** that can participate in conversations as a documentation expert.  
* Triggered only when explicitly mentioned (e.g., `@agent`).  
* Can fetch knowledge from your docs and return short, sourced answers.  
* Optional: integrate into **CometChat** chats.  

***

## Prerequisites

* A Mastra project (`npx create-mastra@latest my-mastra-app`).  
* Node.js installed.  
* OpenAI API key in `.env` as `OPENAI_API_KEY`.  
* A CometChat app.  

***

<h3 className="text-2xl font-semibold mb-6 mt-8">
  <span className="inline-flex items-center px-4 py-1.5 rounded-full bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-300 uppercase tracking-wide text-sm">Step 1</span>
</h3>

## Create the Agent

**`src/agents/knowledge/agent.ts`** (view in repo):

- Agent file: `https://REPO_BASE/blob/main/src/agents/knowledge/agent.ts`  
- Docs retriever tool: `https://REPO_BASE/blob/main/src/tools/docsRetriever.ts`  
- *(Optional)* Mastra Docs MCP tool: `https://REPO_BASE/blob/main/src/tools/mcpMastraDocsTool.ts`  
- Knowledge folder: `https://REPO_BASE/tree/main/knowledge`  
- Notes for the agent:
  - Set `name` to **"knowledge"** so the API path is `/api/agents/knowledge/*`.  
  - Instructions should say: respond **only when mentioned**, answer **from retrieved docs**, and include a short **“Sources:”** list.  
  - Register the `docsRetriever` (and `mcpMastraDocsTool` if enabled).  

***

<h3 className="text-2xl font-semibold mb-6 mt-8">
  <span className="inline-flex items-center px-4 py-1.5 rounded-full bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-300 uppercase tracking-wide text-sm">Step 2</span>
</h3>

## Register the Agent in Mastra

**`src/mastra/index.ts`** (view in repo):

- Server entry: `https://REPO_BASE/blob/main/src/mastra/index.ts`  
- Checklist:  
  - Register the agent with key **"knowledge"** → API path `/api/agents/knowledge/*`.  
  - Configure storage/logger as needed (see repo `README.md`).  

***

<h3 className="text-2xl font-semibold mb-6 mt-8">
  <span className="inline-flex items-center px-4 py-1.5 rounded-full bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-300 uppercase tracking-wide text-sm">Step 3</span>
</h3>

## Run the Agent

```bash
rm -rf .mastra/output
npx mastra dev
```

You should see:

```
Mastra API running on port http://localhost:4111/api
```

Test it locally:

```bash
curl -X POST http://localhost:4111/api/agents/knowledge/generate   -H "Content-Type: application/json"   -d '{"messages":[{"role":"user","content":"@agent where is our refund policy documented?"}]}'
```

Expected output: a short answer with a brief **Sources:** list (file names).

***

<h3 className="text-2xl font-semibold mb-6 mt-8">
  <span className="inline-flex items-center px-4 py-1.5 rounded-full bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-300 uppercase tracking-wide text-sm">Step 4</span>
</h3>

## Deploy & Connect

* Deploy the API (`/api/agents/knowledge/generate`) using Render, Railway, Vercel, or any host.  
* In **CometChat Dashboard → AI Agents**, create an agent with:  
  * **Provider**: Mastra  
  * **Agent ID**: `knowledge`  
  * **Deployment URL**: public endpoint from your host  

Now the agent will answer documentation questions on demand—without hijacking the conversation.

***

## Troubleshooting

* **Agent talks too much**: Tighten instructions to only respond when mentioned and to answer from docs.  
* **No results**: Ensure `/knowledge` contains `.md/.mdx` files or that your ingestion job populated the store; verify the retriever path.  
* **MCP tool inert**: Confirm `mcp.json` at repo root and dependency for the docs server is installed in your runtime.  
* **Not visible in chat**: Verify the agent is added as a user in CometChat and enabled in the Dashboard.  
* **404 / Agent not found**: Check that the server registers the agent with key `knowledge`.  

***

## Next Steps

* Add tools like `summarize-doc`, `fetch-policy`, or `link-to-source`.  
* Use embeddings + chunking for better retrieval.  
* Restrict answers to whitelisted folders or domains.  
* Pair with a Relay Agent to fan out to multiple sources and merge results.  

---

**Repository**

* Root: `https://REPO_BASE`  
* Knowledge agent folder: `https://REPO_BASE/tree/main/src/agents/knowledge`  
* Tools: `https://REPO_BASE/tree/main/src/tools`  
* Server/API: `https://REPO_BASE/tree/main/src/mastra`  
* This doc: `https://REPO_BASE/blob/main/docs/ai-agents/mastra-knowledge-agent.mdx`  
