---
title: "Build Your Backend Tool Action Agent with Mastra"
description: "Follow these steps to create a Backend Tool Action Agent in Mastra that can call APIs or perform server-side tasks on behalf of the user."
---

Imagine an assistant that doesn’t just chat—it can **reach into your backend services**. Ask it to “fetch today’s weather,” “create a Jira ticket,” or “update my CRM contact,” and it will safely trigger server-side tools you define.

***

## What You’ll Build

* A **Mastra agent** configured with backend tools.  
* Tools that call external APIs (weather, CRM, support tickets).  
* A deployable agent available via Mastra’s API.  
* Optional integration into **CometChat**, so users can trigger backend workflows in chat.  

***

## Prerequisites

* A Mastra project (`npx create-mastra@latest my-mastra-app`).  
* Node.js installed.  
* OpenAI API key in `.env` as `OPENAI_API_KEY`.  
* API credentials for any external service you want to call (optional).  

***

<h3 className="text-2xl font-semibold mb-6 mt-8">
  <span className="inline-flex items-center px-4 py-1.5 rounded-full bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-300 uppercase tracking-wide text-sm">Step 1</span>
</h3>

## Create Backend Tools

**`src/tools/weather-tool.ts`**:

```ts
import { createTool } from '@mastra/core/tools';
import { z } from 'zod';
import fetch from 'node-fetch';

export const weatherTool = createTool({
  id: 'get-weather',
  description: 'Fetch current weather for a city.',
  inputSchema: z.object({
    city: z.string().describe('City to get weather for'),
  }),
  outputSchema: z.object({
    temperature: z.number(),
    condition: z.string(),
  }),
  execute: async ({ context }) => {
    const { city } = context;
    // Replace with your weather API
    const resp = await fetch(`https://api.weatherapi.com/v1/current.json?key=API_KEY&q=${city}`);
    const data = await resp.json();
    return {
      temperature: data.current.temp_c,
      condition: data.current.condition.text,
    };
  },
});
```

***

<h3 className="text-2xl font-semibold mb-6 mt-8">
  <span className="inline-flex items-center px-4 py-1.5 rounded-full bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-300 uppercase tracking-wide text-sm">Step 2</span>
</h3>

## Create the Agent

**`src/agents/backend-action-agent.ts`**:

```ts
import { openai } from '@ai-sdk/openai';
import { Agent } from '@mastra/core/agent';
import { Memory } from '@mastra/memory';
import { LibSQLStore } from '@mastra/libsql';

import { weatherTool } from '../tools/weather-tool';

export const backendActionAgent = new Agent({
  name: 'Backend Action Agent',
  instructions: `
You are a helpful assistant. Use tools when appropriate to answer questions.
- Use 'get-weather' when asked about weather.
- Keep answers short and return structured info where possible.
  `,
  model: openai('gpt-4o-mini'),
  tools: {
    'get-weather': weatherTool,
  },
  memory: new Memory({
    storage: new LibSQLStore({ url: 'file:../mastra.db' }),
  }),
});
```

***

<h3 className="text-2xl font-semibold mb-6 mt-8">
  <span className="inline-flex items-center px-4 py-1.5 rounded-full bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-300 uppercase tracking-wide text-sm">Step 3</span>
</h3>

## Register the Agent in Mastra

**`src/mastra/index.ts`**:

```ts
import { Mastra } from '@mastra/core/mastra';
import { PinoLogger } from '@mastra/loggers';
import { LibSQLStore } from '@mastra/libsql';

import { backendActionAgent } from '../agents/backend-action-agent';

export const mastra = new Mastra({
  agents: { 'backend-action': backendActionAgent }, // API path: /api/agents/backend-action/*
  storage: new LibSQLStore({ url: 'file:../mastra.db' }),
  logger: new PinoLogger({ name: 'Mastra', level: 'info' }),
});
```

***

<h3 className="text-2xl font-semibold mb-6 mt-8">
  <span className="inline-flex items-center px-4 py-1.5 rounded-full bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-300 uppercase tracking-wide text-sm">Step 4</span>
</h3>

## Run the Agent

```bash
rm -rf .mastra/output
npx mastra dev
```

You should see:

```
Mastra API running on port http://localhost:4111/api
```

Test it locally:

```bash
curl -X POST http://localhost:4111/api/agents/backend-action/generate   -H "Content-Type: application/json"   -d '{"messages":[{"role":"user","content":"What is the weather in London?"}]}'
```

Expected output:

```json
{
  "temperature": 17,
  "condition": "Partly cloudy"
}
```

***

<h3 className="text-2xl font-semibold mb-6 mt-8">
  <span className="inline-flex items-center px-4 py-1.5 rounded-full bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-300 uppercase tracking-wide text-sm">Step 5</span>
</h3>

## Deploy & Connect

* Deploy the API (`/api/agents/backend-action/generate`) using Render, Railway, Vercel, or any host.  
* In **CometChat Dashboard → AI Agents**, create an agent with:  
  * **Provider**: Mastra  
  * **Agent ID**: `backend-action`  
  * **Deployment URL**: public endpoint from your host  

Now users in chat can type “What’s the weather in London?” and the agent will call your backend weather tool.

***

## Troubleshooting

* **Tool not firing**: Ensure the tool `id` matches between tool file and agent.  
* **API errors**: Verify credentials and API keys for external services.  
* **Empty responses**: Add instructions in the agent prompt about when to use the tool.  

***

## Next Steps

* Add more tools (e.g., Jira ticket creator, CRM updater).  
* Combine with Frontend Action Agent so users can both **see data** and **navigate UI**.  
* Add logging and monitoring for all tool invocations.  
