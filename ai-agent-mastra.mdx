---
title: "Create an AI Agent with Mastra (CometChat)"
sidebarTitle: "Create AI Agent (Mastra)"
description: "Connect a Mastra agent to CometChat, customize it with Chat Builder, and ship it as React UI Kit code or a Chat Widget."
---

<Callout>
**Developer Preview**: AI Agents currently support **Mastra**. OpenAI, Agno, and other providers are coming soon.
</Callout>

## What you’ll build

- A **Mastra** agent with tools/actions  
- The same agent **connected to CometChat** (Agent ID + Deployment URL)  
- A **customized chat experience** using **Chat Builder**  
- An export to **React UI Kit code** _or_ **Chat Widget** for integration

---

## Prerequisites

- A CometChat account and an app: **[Create App](https://app.cometchat.com/apps)**
- A Mastra agent (ID + public Deployment URL) — follow Mastra’s quickstart:  
  **[Mastra Quickstart](https://docs.copilotkit.ai/mastra/quickstart?agent=bring-your-own&package-manager=npm)**

---

## Step 1 — Create your CometChat app

1. Sign in at **[app.cometchat.com](https://app.cometchat.com/apps)**.  
2. Create a new app or open an existing one.  
3. Note your **App ID**, **Region**, and **Auth Key** (you’ll need these if you export the Chat Widget later).

---

## Step 2 — Connect your Mastra Agent

Navigate to **AI Agent → Get Started** and then **AI Agents → Add Agent**.

<Steps>
  <Step title="Choose provider">
    Select **Mastra**.
  </Step>
  <Step title="Basic details">
    Provide:
    - **Name** and optional **Icon**
    - (Optional) **Greeting** and **Introductory Message**
    - (Optional) **Suggested messages**
  </Step>
  <Step title="Mastra configuration">
    Paste the following from your Mastra deployment:
    - **Mastra Agent ID**
    - **Deployment URL** (public URL that CometChat can reach)
  </Step>
  <Step title="Save & enable">
    Click **Save**, then ensure the agent’s toggle is **ON** in **AI Agents** list.
  </Step>
</Steps>

> **Tip:** If you update your Mastra agent later (prompts, tools, routing), you won’t need to re-connect it in CometChat—just keep the **Agent ID** and **Deployment URL** the same.

---

## (Optional) Step 3 — Define Frontend Actions

Use **AI Agent → Actions** to create **frontend actions** your agent can call (e.g., “Open Product,” “Start Demo,” “Book Slot”). These appear to users as structured, safe operations.

When adding a tool:

- **Display Name**: Shown to users (e.g., “Open Product Page”)
- **Execution Text**: How the agent should *describe* running it (e.g., “Opening product details for the user.”)
- **Name**: A unique, code-friendly key (e.g., `open_product`)
- **Description**: What this tool does and when to use it
- **Parameters**: JSON Schema describing inputs (the agent will fill these)

**Example parameters JSON**
```json
{
  "type": "object",
  "required": ["productId"],
  "properties": {
    "productId": {
      "type": "string",
      "description": "The internal product ID to open"
    },
    "utm": {
      "type": "string",
      "description": "Optional tracking code"
    }
  }
}
```

At runtime, your UI should listen for these tool calls and execute them client-side (e.g., route changes, modals, highlights).

---

## Step 4 — Customize with Chat Builder

Open **Chat Builder** to design your agent’s chat experience visually:

- Enable/disable features (typing indicators, attachments, message reactions, etc.)
- Tweak theme, brand colors, layout
- Attach the **Mastra** agent you just connected

**Learn more:**
- **Chat Builder (React UI Kit)**: https://www.cometchat.com/docs/ui-kit/react/builder-integration  
- **Chat Widget overview**: https://www.cometchat.com/docs/widget/overview  
- **Live preview**: https://preview.cometchat.com/

---

## Step 5 — Export & Integrate

You have two export paths—pick the one that fits your app.

### A) Export **React UI Kit** code

Chat Builder can export a ready-to-run React UI (components + config). Import into your existing React app and wire up auth (login users with your preferred flow). Follow the generated `README` for any environment variables.

**You’ll use your app’s** `appID`, `region`, and an auth mechanism (e.g., `authKey` for dev, or your own token service in prod).

### B) Export **Chat Widget** (HTML/JS)

Embed a docked widget with minimal code. Example:

```html
<div id="cometchat"></div>
<script src="https://widget-js.cometchat.io/v3/cometchatwidget.js"></script>
<script>
  CometChatWidget.init({
    appID: "YOUR_APP_ID",
    region: "YOUR_REGION"
  }).then(() => {
    // For dev/testing you can use authKey; for production use a secure token service.
    CometChatWidget.login({
      uid: "USER_ID",
      authToken: "AUTH_TOKEN"
    }).then(() => {
      CometChatWidget.launch({
        widgetID: "WIDGET_ID_FROM_CHAT_BUILDER_EXPORT",
        target: "#cometchat",
        docked: true
      });
    });
  });
</script>
```

> **Note:** The **Mastra agent** you connected in Step 2 is already part of the exported configuration, so your end-users will chat with that agent immediately.

---

## Quick Mastra Setup (Reference)

If you haven’t deployed a Mastra agent yet, here’s the minimal shape. Use the Mastra quickstart for exact commands and project layout.

**Define an agent with tools**
```ts
// mastra/agent.ts
import { defineAgent } from "mastra"; // refer to Mastra docs for exact import

export const supportAgent = defineAgent({
  name: "My Agent 1",
  instructions: \`
You are a helpful support agent for Acme. Use tools when appropriate.
\`,
  tools: [
    {
      name: "open_product",
      description: "Open a product by ID in the UI",
      parameters: {
        type: "object",
        required: ["productId"],
        properties: { productId: { type: "string" } }
      },
    },
  ],
});
```

**Expose a public HTTP endpoint**
```ts
// server.ts
import express from "express";
import { supportAgent } from "./mastra/agent";

const app = express();
app.use(express.json());

app.post("/mastra/agent", async (req, res) => {
  const { messages } = req.body; // follow Mastra’s expected schema
  const result = await supportAgent.respond({ messages });
  res.json(result);
});

app.listen(process.env.PORT || 3000, () => {
  console.log("Mastra agent running");
});
```

Deploy this (e.g., Vercel, Render, Fly, your infra) and copy the **public URL** as your **Deployment URL**. Also copy your **Mastra Agent ID** from your Mastra dashboard/config.

- **Docs**: https://docs.copilotkit.ai/mastra/quickstart?agent=bring-your-own&package-manager=npm

---

## Test your setup

1. In **AI Agents**, ensure your Mastra agent shows **Enabled**.  
2. Open **Chat Builder** → start a preview session.  
3. Send a message; confirm the agent responds.  
4. Trigger a **Frontend Action** and verify your UI handles the tool call.

---

## Troubleshooting

- **“Agent not responding”**
  - Verify your **Deployment URL** is publicly reachable (no VPN/firewall).
  - Check server logs for 4xx/5xx errors.
- **“Tool call not executed”**
  - Confirm the Action’s **Name** in CometChat exactly matches the tool name your UI listens for.
  - Validate the **Parameters** JSON Schema; the agent uses this to fill inputs.
- **Auth issues in exports**
  - Use `authKey` only for development. For production, implement a **secure token** flow for user login.

---

## Next steps

- Add more **Actions** to expand capabilities (calendar, payments, navigation).  
- Localize responses and UI theme with Chat Builder.  
- Wire analytics/observability to measure agent resolution and CSAT.

---

## Screenshots (add to repo/media and reference)

<Cards>
  <Card title="Get Started (Overview)">
    <Img src="/images/ai-agent-get-started.png" alt="CometChat AI Agent Get Started" />
  </Card>
  <Card title="AI Agents List">
    <Img src="/images/ai-agents-list.png" alt="AI Agents list with Mastra agent enabled" />
  </Card>
  <Card title="Connect Mastra Agent">
    <Img src="/images/ai-agent-connect-form.png" alt="Connect Agent form" />
  </Card>
  <Card title="Create Frontend Action">
    <Img src="/images/ai-actions-empty.png" alt="AI Tools empty state" />
    <Img src="/images/ai-actions-create.png" alt="Create Tool form" />
  </Card>
</Cards>
